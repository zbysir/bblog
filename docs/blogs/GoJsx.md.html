<!DOCTYPE html><html lang="zh"><head><meta charSet="UTF-8"/><title>bysir 的博客</title><link href="/tailwind.css" rel="stylesheet"/><link href="/blog/tailwind.css" rel="stylesheet"/></head><body><div><section class="w-full px-8 text-gray-700 bg-white"><div class="container flex flex-col flex-wrap items-center justify-between py-5 mx-auto md:flex-row max-w-7xl"><div class="relative flex flex-col md:flex-row"><a href="#_" class="flex items-center mb-5 font-medium text-gray-900 lg:w-auto lg:items-center lg:justify-center md:mb-0"><span class="mx-auto text-xl font-black leading-none text-gray-900 select-none"> bysir <span class="text-indigo-600">.</span></span></a><nav class="flex flex-wrap items-center mb-5 text-base md:mb-0 md:pl-8 md:ml-8 md:border-l md:border-gray-200"><a href="#_" class="mr-5 font-medium leading-6 text-gray-600 hover:text-gray-900">Home</a><a href="#_" class="mr-5 font-medium leading-6 text-gray-600 hover:text-gray-900">Blog</a></nav></div><div class="inline-flex items-center ml-5 space-x-6 lg:justify-end"><a href="#" class="inline-flex items-center justify-center px-4 py-2 text-base font-medium leading-6 text-white whitespace-no-wrap bg-indigo-600 border border-transparent rounded-md shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-600">Sign up</a></div></div></section></div><div class="container mx-auto p-6 bg-white flex"><div class="prose"><h2> GoJsx.md </h2><div><h1>gojsx</h1>

<p>Render React Jsx by Golang</p>

<p>使用 Go 渲染 Jsx。</p>

<p>Jsx 优势：</p>

<ul>
<li>实际上就是 js 代码，它是图灵完备的。</li>
<li>和 js 生态行为一致，不用学习更多语法。</li>
</ul>

<h2>例子</h2>

<p>编写 jsx 文件（或者 tsx）</p>

<pre><code class="language-jsx">import App from &quot;./App&quot;;

export default function Index(props) {
  return &lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charSet=&quot;UTF-8&quot;/&gt;
    &lt;title&gt;Title&lt;/title&gt;
    &lt;link href=&quot;https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css&quot; rel=&quot;stylesheet&quot;/&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;App {...props}&gt;&lt;/App&gt;
  &lt;/body&gt;
  &lt;/html&gt;
}
</code></pre>

<pre><code class="language-go">package jsx

func TestJs(t *testing.T) {
	j, err := NewJsx()
	if err != nil {
		t.Fatal(err)
	}

	s, err := j.Render(&quot;./test/Index&quot;, map[string]interface{}{&quot;li&quot;: []int64{1, 2, 3, 4}})
	if err != nil {
		t.Fatal(err)
	}

	t.Logf(&quot;%+v&quot;, s)
}
</code></pre>

<h2>实现原理</h2>

<p>由于 Jsx 实际上就是 js 代码，如果要渲染 jsx，则需要在 Golang 中运行 js 代码，感谢伟大的 goja 库。</p>

<p>由于 goja 只支持 es5.1 语法，高级语法如 TS、ES6 则需要通过 babel 转换，babel 提供一个浏览器运行版本，刚好 goja 可以运行它。</p>

<p>将编译之后的 jsx 交给 goja 运行，能得到一个虚拟节点树，然后再由 golang 进行渲染得到 HTML。</p>

<h2>性能</h2>

<p>babel 是十分慢的，相信开发过前端的朋友都深有体会，但我们可以通过预编译来减少影响。除此之外运行编译好的 jsx 模板是很快的（ goja 本身很快），不必担心。</p>

<p>另外 这个项目应该是性能不敏感的，我想用它来生成静态文件（例如制作官网与博客），而不是实时渲染。</p>

<h2>FQA</h2>

<h3>支持 React 的 UI 库吗？ 如 ant</h3>

<p>不支持，由于库的复杂依赖关系，会出现意料之外的错误，也会导致加载变得很慢。</p>

<p>如果你非要使用，尝试使用 webpack 将依赖打包成独立的 js 文件，然后引入它（待测试）。</p>
</div></div></div><div></div></body></html>